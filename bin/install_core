#!/usr/bin/env bash

git_status=$( (git status) 2>&1 )

if [ "$git_status" = "fatal: Not a git repository (or any of the parent directories): .git" ]; then
    echo "Must execute within nupic.core repository!"
    exit
fi

repo=`basename \`git rev-parse --show-toplevel\``

if [ "$repo" != "nupic.core" ]; then
    echo "Must execute within nupic.core repository!"
    exit
fi

echo Clearing out existing build directory..
rm -rf build
mkdir -p build/scripts
cd build/scripts
echo 
echo Calling CMake...
cmake ../../src -DCMAKE_INSTALL_PREFIX=../release

# optionally start a fresh build
echo
echo Cleaning...
make clean
echo
echo Making...
make -j6

echo
echo Installing...
make install
