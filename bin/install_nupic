#!/usr/bin/env bash
# ----------------------------------------------------------------------
# Numenta Platform for Intelligent Computing (NuPIC)
# Copyright (C) 2015, Numenta, Inc.  Unless you have an agreement
# with Numenta, Inc., for a separate license for this software code, the
# following terms and conditions apply:
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License version 3 as
# published by the Free Software Foundation.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# ----------------------------------------------------------------------

: ${NUPIC:?"You must set the NUPIC environment variable."}
: ${NUPIC_CORE:?"You must set the NUPIC_CORE environment variable."}

clean_build=0
verbose=''
user_flag=''
core_release_dir=''

print_usage () {
  echo "Installs NuPIC from $NUPIC directory. If nupic.core release directory"
  echo "is not specified with -u or -r options (see below), the nupic.core"
  echo "binary package is downloaded."
  echo
  echo "Usage:"
  echo "> install_nupic [options]"
  echo
  echo "Options:"
  echo " -c Clean build, removes old build artifacts."
  echo " -v Verbose console output."
  echo " -u Runs python setup.py install with the --user option."
}

# cmd line options processing
process_options () {
  while getopts "cvnur:" optname
    do
      case "$optname" in
        "c")
          clean_build=1
          ;;
        "v")
          verbose=1
          ;;
        "u")
          user_flag="--user"
          ;;
        "?")
          print_usage
          exit
          ;;
        ":")
          print_usage
          exit
          ;;
        *)
          # Should not occur
          print_usage
          exit
          ;;
      esac
    done
  return $OPTIND
}

process_options "$@"
argstart=$?

pushd "$NUPIC"

if [ "${clean_build}" -eq "1" ] ; then
  echo Clearing out existing build and dist directories..
  rm -rf build dist
fi

echo "Building NuPIC assuming nupic.bindings has been installed..."
VERBOSE="${verbose}" python setup.py install ${user_flag}

popd
